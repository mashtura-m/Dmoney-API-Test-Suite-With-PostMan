{
	"info": {
		"_postman_id": "50488459-3101b5c4-a838-400b-8ae4-ac575304168e",
		"name": "Dmoney-API-Test-Suite-With-PM",
		"description": "A professionally structured collection for Dmoney REST API following the end-to-end lifecycle of financial transactions.",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "01. Security & Authentication",
			"item": [
				{
					"name": "Admin Login - Invalid Password",
					"id": "50488459-523a982f-2bae-421b-8192-582dd8e3911f",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\"email\": \"{{adminEmail}}\", \"password\": \"wrong\"}"
						},
						"url": {
							"raw": "{{baseUrl}}/user/login",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"user",
								"login"
							]
						}
					},
					"response": []
				},
				{
					"name": "Admin Login - Valid",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "dc421506-41a3-4057-a2e3-953ead2d9ddc",
								"exec": [
									"",
									"if (pm.response.code === 200) {    ",
									"",
									"    var jsonData = pm.response.json();",
									"",
									"    // 3. Extract the token and save it to Collection Variables",
									"    if (jsonData.token) {",
									"        let role=jsonData.role",
									"        console.log(\"ROLE: \"+role)",
									"        let auth_token=role+\"-auth-token\"",
									"        pm.collectionVariables.set(auth_token, jsonData.token);",
									"        console.log(\"Success: Token saved to collection variable 'role-auth-token'\"+pm.auth_token);",
									"    } else {",
									"        console.log(\"Error: Token field not found in response body\");",
									"    }",
									"",
									"} else {",
									"    console.log(\"Login failed. Status code: \" + pm.response.code);",
									"}",
									"// pm.test(\"Status code is 200\", function () {",
									"//     pm.response.to.have.status(200);",
									"// });",
									"// pm.test(\"Login successfully\", function () {",
									"//     pm.expect(pm.response.text()).contains(\"Login successful\");",
									"// });",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"id": "50488459-42064d94-6fbc-474d-8d7c-b2462377bbe9",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"email\": \"{{adminEmail}}\",\n    \"password\": \"1234\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/user/login",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"user",
								"login"
							]
						}
					},
					"response": []
				},
				{
					"name": "System Login",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "dc421506-41a3-4057-a2e3-953ead2d9ddc",
								"exec": [
									"",
									"if (pm.response.code === 200) {    ",
									"",
									"    var jsonData = pm.response.json();",
									"",
									"    // 3. Extract the token and save it to Collection Variables",
									"    if (jsonData.token) {",
									"        let role=jsonData.role",
									"        console.log(\"ROLE: \"+role)",
									"        let auth_token=role+\"-auth-token\"",
									"        pm.collectionVariables.set(auth_token, jsonData.token);",
									"        console.log(\"Success: Token saved to collection variable 'role-auth-token'\"+pm.auth_token);",
									"    } else {",
									"        console.log(\"Error: Token field not found in response body\");",
									"    }",
									"",
									"} else {",
									"    console.log(\"Login failed. Status code: \" + pm.response.code);",
									"}",
									"// pm.test(\"Status code is 200\", function () {",
									"//     pm.response.to.have.status(200);",
									"// });",
									"// pm.test(\"Login successfully\", function () {",
									"//     pm.expect(pm.response.text()).contains(\"Login successful\");",
									"// });",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"id": "50488459-9cb90d23-b25a-423c-8bb6-c561e393947a",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"email\": \"{{systemEmail}}\",\n    \"password\": \"1234\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/user/login",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"user",
								"login"
							]
						}
					},
					"response": []
				}
			],
			"id": "50488459-6cabae78-fab7-452d-8140-94b83848c52b",
			"description": "Handles Admin login and token retrieval.",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"id": "362ada38-7370-472b-9997-d9dbcb358e2f",
						"type": "text/javascript",
						"packages": {},
						"requests": {},
						"exec": [
							""
						]
					}
				},
				{
					"listen": "test",
					"script": {
						"id": "824d5528-bdef-4572-aad9-e5dba1d18d58",
						"type": "text/javascript",
						"packages": {},
						"requests": {},
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"pm.test(\"Login successfully\", function () {",
							"    pm.expect(pm.response.text()).contains(\"Login successful\");",
							"});",
							""
						]
					}
				}
			]
		},
		{
			"name": "02. User Onboarding",
			"item": [
				{
					"name": "Positive Scenarios",
					"item": [
						{
							"name": "Create Random User",
							"id": "50488459-b8e6c979-f774-4ea0-855b-24c1c9bd30a6",
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"name\": \"ABC123\",\n  \"email\": \"xxx@gmail.com\",\n  \"password\": \"1234\", \n  \"phone_number\": \"01234567892\",\n  \"nid\": \"012wert123456\",\n}"
								},
								"url": {
									"raw": "{{baseUrl}}/user/create",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"user",
										"create"
									]
								}
							},
							"response": []
						}
					],
					"id": "50488459-e4f19f25-7ae6-4751-93d6-dc19521b7d60",
					"auth": {
						"type": "noauth"
					},
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"id": "4c96c307-f6c4-4dc9-8a3f-bc3ad4fe8b1f",
								"type": "text/javascript",
								"packages": {},
								"requests": {},
								"exec": [
									""
								]
							}
						},
						{
							"listen": "test",
							"script": {
								"id": "6821dbbe-c453-4404-9ff3-a1830b2f264a",
								"type": "text/javascript",
								"packages": {},
								"requests": {},
								"exec": [
									""
								]
							}
						}
					]
				},
				{
					"name": "Negative Scenarios",
					"item": [
						{
							"name": "Create User - Duplicate Phone",
							"id": "50488459-3923e164-76f4-427f-8cdb-75abbc183e15",
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"method": "POST",
								"header": [],
								"url": {
									"raw": "{{baseUrl}}/user/create",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"user",
										"create"
									]
								}
							},
							"response": []
						},
						{
							"name": "Create User - Unauthorized (No Token)",
							"id": "50488459-84eeb73e-7489-4785-9a28-f995f3c31393",
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"method": "POST",
								"header": [],
								"url": {
									"raw": "{{baseUrl}}/user/create",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"user",
										"create"
									]
								}
							},
							"response": []
						}
					],
					"id": "50488459-51077ad5-aa81-4664-9f52-bd069ec7ab01"
				}
			],
			"id": "50488459-c723f8de-51b0-4542-a005-24503b40438a",
			"description": "Admin creating Agent, Customers, and Merchant.",
			"auth": {
				"type": "bearer",
				"bearer": [
					{
						"key": "token",
						"value": "{{Admin-auth-token}}",
						"type": "string"
					}
				]
			},
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"id": "2814617e-b24a-4bf4-9a5a-e2b4f8e25f8c",
						"type": "text/javascript",
						"requests": {},
						"exec": [
							"// 1. Retrieve the keys from variables",
							"const authToken = pm.variables.get(\"Admin-auth-token\");",
							"const secretKey = pm.variables.get(\"secret-key\");",
							"",
							"// 2. Check if keys exist, then inject them into the header",
							"if (authToken) {",
							"    // Note: Adjust \"Authorization\" to \"auth-token\" if your API uses that specific header key",
							"    pm.request.headers.add({",
							"        key: 'Authorization',",
							"        value: `Bearer ${authToken}` // Common standard. Remove 'Bearer ' if your API just sends the raw token.",
							"    });",
							"}",
							"",
							"if (secretKey) {",
							"    pm.request.headers.add({",
							"        key: 'X-AUTH-SECRET-KEY',",
							"        value: secretKey",
							"    });",
							"}",
							"console.log('Headers injected via Collection Script ${authToken}');"
						]
					}
				},
				{
					"listen": "test",
					"script": {
						"id": "4a4919e1-7a3c-46b0-8d9c-5afb65c3f5a5",
						"type": "text/javascript",
						"packages": {},
						"requests": {},
						"exec": [
							""
						]
					}
				}
			]
		},
		{
			"name": "03. Send Money",
			"item": [
				{
					"name": "System to Agent Deposit",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"id": "668202ab-b5ca-43bd-8c15-968e1ddf4b6c",
								"exec": [
									"const authToken = pm.variables.get(\"Agent-auth-token\");",
									"const secretKey = pm.variables.get(\"secret-key\");",
									"",
									"// 2. Check if keys exist, then inject them into the header",
									"if (authToken) {",
									"    // Note: Adjust \"Authorization\" to \"auth-token\" if your API uses that specific header key",
									"    pm.request.headers.add({",
									"        key: 'Authorization',",
									"        value: `Bearer ${authToken}` // Common standard. Remove 'Bearer ' if your API just sends the raw token.",
									"    });",
									"}",
									"",
									"if (secretKey) {",
									"    pm.request.headers.add({",
									"        key: 'X-AUTH-SECRET-KEY',",
									"        value: secretKey",
									"    });",
									"}",
									"console.log('Headers injected via Collection Script ${authToken}');"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"id": "50488459-dcba282a-2f7c-403f-a28f-977e2e8ef7b3",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"from_account\": \"SYSTEM\",\n  \"to_account\": \"01771665896\",\n  \"amount\": 50000\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/transaction/deposit",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"transaction",
								"deposit"
							]
						}
					},
					"response": []
				},
				{
					"name": "Agent to Customer Deposit",
					"id": "50488459-a2e0fd3f-28f3-4d99-9e7c-6ce1bde6863b",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"from_account\": \"01305187403\",\n  \"to_account\": \"01771665896\",\n  \"amount\": 2000\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/transaction/deposit",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"transaction",
								"deposit"
							]
						}
					},
					"response": []
				},
				{
					"name": "Customer to Customer Send Money",
					"id": "50488459-3788a693-e960-4d52-9739-ebe391ae6873",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"from_account\": \"01771665896\",\n  \"to_account\": \"01223331124\",\n  \"amount\": 2000\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/transaction/sendmoney",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"transaction",
								"sendmoney"
							]
						}
					},
					"response": []
				},
				{
					"name": "Negative - Insufficient Balance Transfer",
					"id": "50488459-f986b762-5857-4437-90be-b32ed8a1faa8",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"from_account\": \"01771665896\",\n  \"to_account\": \"01223331124\",\n  \"amount\": 2000\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/transaction/sendmoney",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"transaction",
								"sendmoney"
							]
						}
					},
					"response": []
				}
			],
			"id": "50488459-eb920b70-2a52-4ef6-baa8-e75063ae65bb",
			"description": "Handles System funding and P2P transfers.",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"id": "17fde120-6a35-487c-9be3-d54e69d80ccc",
						"type": "text/javascript",
						"packages": {},
						"requests": {},
						"exec": [
							"const authToken = pm.variables.get(\"Agent-auth-token\");",
							"const secretKey = pm.variables.get(\"secret-key\");",
							"",
							"// 2. Check if keys exist, then inject them into the header",
							"if (authToken) {",
							"    // Note: Adjust \"Authorization\" to \"auth-token\" if your API uses that specific header key",
							"    pm.request.headers.add({",
							"        key: 'Authorization',",
							"        value: `Bearer ${authToken}` // Common standard. Remove 'Bearer ' if your API just sends the raw token.",
							"    });",
							"}",
							"",
							"if (secretKey) {",
							"    pm.request.headers.add({",
							"        key: 'X-AUTH-SECRET-KEY',",
							"        value: secretKey",
							"    });",
							"}",
							"console.log('Headers injected via Collection Script ${authToken}');",
							"",
							"// Retrieve data for transaction",
							""
						]
					}
				},
				{
					"listen": "test",
					"script": {
						"id": "45e3c7d9-0b55-47ad-ad1d-3367585e14bb",
						"type": "text/javascript",
						"packages": {},
						"requests": {},
						"exec": [
							"pm.test(\"Status code is 201\", function () {",
							"    pm.response.to.have.status(201);",
							"});",
							"pm.test(\"Deposit successfully\", function () {",
							"    pm.expect(pm.response.text()).contains(\"successful\");",
							"});",
							""
						]
					}
				}
			]
		},
		{
			"name": "04. Merchant & Utility Flows",
			"item": [
				{
					"name": "Customer Withdrawal to Agent",
					"id": "50488459-6b889d4b-8f97-4f99-b110-f1e9638137e5",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "POST",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/transaction/withdraw",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"transaction",
								"withdraw"
							]
						}
					},
					"response": []
				},
				{
					"name": "Customer Payment to Merchant",
					"id": "50488459-a15ca78b-a986-453a-b204-581cae1b5550",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "POST",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/transaction/payment",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"transaction",
								"payment"
							]
						}
					},
					"response": []
				},
				{
					"name": "Negative - Withdrawal Below Minimum (10 TK)",
					"id": "50488459-676edb8d-9803-4793-8ed1-646b53eab0c4",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "POST",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/transaction/withdraw",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"transaction",
								"withdraw"
							]
						}
					},
					"response": []
				}
			],
			"id": "50488459-a0247881-137c-49ef-82a5-415c9f1191aa",
			"description": "Withdrawals and Merchant payments."
		},
		{
			"name": "05. Inquiries & Auditing",
			"item": [
				{
					"name": "Check Agent Balance",
					"id": "50488459-77a69d4b-43fa-41e6-9f68-63a93fb8d943",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/transaction/balance/{{agentPhone}}",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"transaction",
								"balance",
								"{{agentPhone}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Check Customer Statement",
					"id": "50488459-393e4a8a-628e-4f68-a7bf-4b92678ca182",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/transaction/statement/{{customerPhone}}",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"transaction",
								"statement",
								"{{customerPhone}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Search Transaction by ID",
					"id": "50488459-5f7948f4-deac-4ef5-b294-c2233be0bbf2",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/transaction/search/{{trnxId}}",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"transaction",
								"search",
								"{{trnxId}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Negative - Check Balance for Invalid Phone",
					"id": "50488459-bac3722d-eb77-4dc2-aad7-b27b17599f17",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/transaction/balance/0000",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"transaction",
								"balance",
								"0000"
							]
						}
					},
					"response": []
				}
			],
			"id": "50488459-681ba7e7-35fc-4b57-a172-61adbd531e44",
			"description": "Balance checks and transaction history."
		},
		{
			"name": "Search Data",
			"item": [
				{
					"name": "search Agent",
					"id": "50488459-e1caf693-82ee-445f-ab87-7a6a658214c8",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "{{baseUrl}}/user/search/agent",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"user",
								"search",
								"agent"
							]
						}
					},
					"response": []
				}
			],
			"id": "50488459-5b734fdd-4fc6-4ace-a51c-cf6aaeac0c78",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"id": "a15b3364-e53a-4b7d-984d-8b0f6d6402ae",
						"type": "text/javascript",
						"packages": {},
						"requests": {},
						"exec": [
							"const authToken = pm.variables.get(\"Admin-auth-token\");",
							"const secretKey = pm.variables.get(\"secret-key\");",
							"",
							"// 2. Check if keys exist, then inject them into the header",
							"if (authToken) {",
							"    // Note: Adjust \"Authorization\" to \"auth-token\" if your API uses that specific header key",
							"    pm.request.headers.add({",
							"        key: 'Authorization',",
							"        value: `Bearer ${authToken}` // Common standard. Remove 'Bearer ' if your API just sends the raw token.",
							"    });",
							"}",
							"",
							"if (secretKey) {",
							"    pm.request.headers.add({",
							"        key: 'X-AUTH-SECRET-KEY',",
							"        value: secretKey",
							"    });",
							"}",
							"console.log('Headers injected via Collection Script ${authToken}');"
						]
					}
				},
				{
					"listen": "test",
					"script": {
						"id": "1f4d24ae-ee1a-441f-be51-a2831b567c3b",
						"type": "text/javascript",
						"packages": {},
						"requests": {},
						"exec": [
							""
						]
					}
				}
			]
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"id": "8979df32-4bf8-46a9-ab45-a0ab93d09486",
				"type": "text/javascript",
				"packages": {},
				"requests": {},
				"exec": [
					"pm.collectionVariables.set(\"secret-key\",\"ROADTOSDET\")",
					"pm.collectionVariables.set('baseUrl',\"https://dmoney.roadtocareer.net\")",
					"pm.collectionVariables.set('systemEmail',\"system@dmoney.com\")",
					"pm.collectionVariables.set('adminEmail',\"admin@dmoney.com\")",
					"pm.collectionVariables.set('pswd',\"1234\")"
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"id": "4adf817d-bfd6-4282-bbe6-ccfec871fb20",
				"type": "text/javascript",
				"packages": {},
				"requests": {},
				"exec": [
					""
				]
			}
		}
	],
	"variable": [
		{
			"key": "baseUrl",
			"value": ""
		},
		{
			"key": "adminEmail",
			"value": ""
		},
		{
			"key": "secret-key",
			"value": ""
		},
		{
			"key": "systemEmail",
			"value": ""
		},
		{
			"key": "pswd",
			"value": ""
		},
		{
			"key": "Admin-auth-token",
			"value": ""
		},
		{
			"key": "Agent-auth-token",
			"value": ""
		}
	]
}